<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Electricity Rate Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f9f4;
      color: #333;
      margin: 0;
      padding: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    table, th, td {
      border: 1px solid #4CAF50;
    }

    th, td {
      padding: 10px;
      text-align: center;
    }

    th {
      background-color: #e8f5e9;
    }

    label {
      font-weight: bold;
      display: block;
      margin-bottom: 10px;
    }

    input[type="number"] {
      width: 100%;
      padding: 10px;
      border: 2px solid #4CAF50;
      border-radius: 5px;
      box-sizing: border-box;
      font-size: 1rem;
      position: relative;
      z-index: 1;
      background-color: #fff;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }

    input[type="number"]:focus {
      border-color: #388E3C;
      outline: none;
    }

    #summerResult, #notSummerResult {
      font-size: 1.2rem;
      font-weight: bold;
      margin-top: 20px;
    }

    /* 閃電特效 - 動態調整 */
    #summerResult.lightning-effect-small, #notSummerResult.lightning-effect-small {
      animation: lightning-small 0.3s ease-out;
      color: #FABB00;
      text-shadow: 0 0 10px #FFD700;
    }

    #summerResult.lightning-effect-medium, #notSummerResult.lightning-effect-medium {
      animation: lightning-medium 0.3s ease-out;
      color: #FF8C00;
      text-shadow: 0 0 15px #FF8C00;
    }

    #summerResult.lightning-effect-large, #notSummerResult.lightning-effect-large {
      animation: lightning-large 0.3s ease-out;
      color: #FF4500;
      text-shadow: 0 0 20px #FF4500;
    }

    @keyframes lightning-small {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes lightning-medium {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.07); }
    }

    @keyframes lightning-large {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    #details {
      margin-top: 15px;
      font-size: 1rem;
      color: #333;
    }

    #details li {
      margin-bottom: 5px;
    }
  </style>
</head>
<body>

  <label for="electricity">輸入用電量 (度):</label>
  <input type="number" id="electricity" name="electricity">
  <p id="summerResult">電費總額(夏季): 0 元 (台電計價)</p>
  <p id="notSummerResult">電費總額(非夏季): 0 元 (台電計價)</p>
  <p id="result">盤子價: 0 元(一度 $5)</p>
  

  <table id="rateTable">
    <thead>
      <tr>
        <th>用電範圍 (度)</th>
        <th>使用度數 (度)</th>
        <th>季節</th>
        <th>費率 (元/度)</th>
        <th>電費 (元)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td colspan="6">輸入使用度數</td>
      </tr>
      <!-- 表格資料將由 JavaScript 動態插入 -->
    </tbody>
  </table>
  <p id="season"></p>

  <script>
    const base = [
      { low: 0, height: 120, summer: 1.68, notSummer: 1.68 },
      { low: 120, height: 330, summer: 2.45, notSummer: 2.16 },
      { low: 330, height: 500, summer: 3.7, notSummer: 3.03 },
      { low: 500, height: 700, summer: 5.04, notSummer: 4.14 },
      { low: 700, height: 1000, summer: 6.24, notSummer: 5.07 },
      { low: 1000, height: '以上', summer: 8.46, notSummer: 6.63 },
    ];

    function getPriceAndDetails(ele) {
      let summerTotal = 0;
      let notSummerTotal = 0;
      let tableBody = document.querySelector('#rateTable tbody');
      if (tableBody) {
        while (tableBody.firstChild) {
          tableBody.removeChild(tableBody.firstChild);
        }
      }
      base.forEach((item, index, arr) => {
        const prevRange = arr[index-1]?.height || 0;
        const currRange = item.height;
        let degree;
        if (ele <= prevRange) return;

        if (item.low === 1000 && ele > 1000) {
          degree = ele - item.low;
        } else if (ele <= currRange) {
          degree = (ele - prevRange)
        } else if (ele > currRange) {
          degree = (currRange - prevRange)
        }

        if (degree > 0) {
          summerTotal += degree * item.summer;
          notSummerTotal += degree * item.notSummer;
          const row = document.createElement('tr');
          // 用電範圍
          const rangeCell = document.createElement('td');
          rangeCell.setAttribute('rowspan', '2');
          rangeCell.textContent = `${item.low} - ${item.height === '以上' ? '以上' : item.height}`;
          row.appendChild(rangeCell);
          // 使用度數
          const degreeCell = document.createElement('td');
          degreeCell.setAttribute('rowspan', '2');
          degreeCell.textContent = degree;
          row.appendChild(degreeCell);
          // 夏季
          const summerCell = document.createElement('td');
          summerCell.textContent = '夏季';
          row.appendChild(summerCell);
          // 夏季費率
          const summerBaseCell = document.createElement('td');
          summerBaseCell.textContent = item.summer;
          row.appendChild(summerBaseCell);
          // 夏季電費
          const summerAmountCell = document.createElement('td');
          summerAmountCell.textContent = (degree*item.summer).toFixed(2);
          row.appendChild(summerAmountCell);

          const row2 = document.createElement('tr');
          // 非夏季
          const notSummerCell = document.createElement('td');
          notSummerCell.textContent = '非夏季';
          row2.appendChild(notSummerCell);
          // 非夏季費率
          const notSummerBaseCell = document.createElement('td');
          notSummerBaseCell.textContent = item.notSummer;
          row2.appendChild(notSummerBaseCell);
          // 非夏季電費
          const notSummerAmountCell = document.createElement('td');
          notSummerAmountCell.textContent = (degree*item.notSummer).toFixed(2);
          row2.appendChild(notSummerAmountCell);

          tableBody.appendChild(row);
          tableBody.appendChild(row2);
        }
      });
      return { summerTotal, notSummerTotal };
    }

    function isSummer() {
      const currentMonth = new Date().getMonth() + 1;
      return currentMonth >= 6 && currentMonth <= 9;
    }

    function getLightningClass(ele) {
      for (let i = base.length - 1; i >= 0; i--) {
        if (ele > base[i].height) {
          if (i >= 4) return 'lightning-effect-large';
          if (i >= 2) return 'lightning-effect-medium';
          return 'lightning-effect-small';
        }
      }
      return '';
    }

    document.getElementById('electricity').addEventListener('input', function() {
      const ele = parseFloat(this.value);
      const { summerTotal, notSummerTotal } = getPriceAndDetails(ele) || { summerTotal: 0, notSummerTotal: 0 };
      const summerResultElement = document.getElementById('summerResult');
      const notSummerResultElement = document.getElementById('notSummerResult');
      const resultElement = document.getElementById('result');
      const seasonElement = document.getElementById('season');
      seasonElement.textContent = `目前季節: ${isSummer() ? '夏季 (6/1 - 9/30)' : '非夏季 (1/1 - 5/30, 10/1 - 12/30)'}`;

      summerResultElement.textContent = `電費總額(夏季): ${summerTotal.toFixed(2)} 元 (台電計價)`;
      notSummerResultElement.textContent = `電費總額(非夏季): ${notSummerTotal.toFixed(2)} 元 (台電計價)`;

      resultElement.textContent = `${((ele * 5) > (summerTotal.toFixed(2)) ? '盤子價:' : '破盤價:')} ${ele * 5} 元 (一度 5 元)`;
      
      // 移除之前的閃電效果類別
      summerResultElement.classList.remove('lightning-effect-small', 'lightning-effect-medium', 'lightning-effect-large');
      notSummerResultElement.classList.remove('lightning-effect-small', 'lightning-effect-medium', 'lightning-effect-large');
      
      // 根據數字範圍動態添加閃電特效
      const lightningClass = getLightningClass(ele);
      if (lightningClass) {
        summerResultElement.classList.add(lightningClass);
        notSummerResultElement.classList.add(lightningClass);
      }
    });
  </script>
</body>
</html>
